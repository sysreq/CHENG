# UX Design Document: Parametric RC Plane Generator

## Overview

This document defines the complete user experience, interaction model, and interface design for the Parametric RC Plane Generator -- a web application that lets hobbyists design custom 3D-printable RC aircraft by manipulating high-level parameters rather than drawing geometry by hand.

**Technology stack:** The application runs as a Docker container (Python/FastAPI + CadQuery backend) and can be deployed either locally via `docker run` or on Google Cloud Run for zero-install cloud access. Three.js renders an interactive 3D preview in the viewport. CadQuery generates the actual parametric geometry and exports STL files for 3D printing (FDM).

**Deployment modes:**
- **Local (Docker):** User runs a Docker container on their machine. Designs are stored on a Docker volume. Full performance, no network latency.
- **Cloud (Google Cloud Run):** User navigates to a URL. No installation required. Designs are stored in the browser via IndexedDB. May experience cold start delay on first access.

**Primary fabrication method: FDM 3D printing.** The tool is designed around the constraints and opportunities of desktop FDM printers. Parameters account for wall thickness, print orientation, part sectioning for bed-size limits, and snap-fit/dovetail assembly joints between printed sections.

The design philosophy follows three principles:

1. **Progressive disclosure** -- show only what matters right now; reveal detail on demand.
2. **Direct manipulation** -- click on the plane, change the plane.
3. **Immediate feedback** -- every parameter change updates the viewport in real time.

The target user is a hobbyist RC builder with moderate technical knowledge (understands wingspan, chord, sweep) but no CAD or aerospace engineering background. The tool should feel closer to TinkerCAD than to CATIA.

---

## 1. User Workflow / Design Flow

### 1.1 Launch Sequence

The application supports two launch paths depending on the deployment mode:

**Local (Docker):**

```
User runs: docker run -p 8000:8000 -v ~/.cheng:/data cheng
  |
  v
Docker container starts
  |-- FastAPI backend initializes on port 8000
  |-- CadQuery geometry engine initializes
  |-- User opens browser to http://localhost:8000
  |     (or a helper script opens the browser automatically)
  |
  v
Template Picker (modal overlay in browser)
  |-- Choose a starter template (Trainer, Sport, Aerobatic, Glider, Flying Wing, Scale)
  |-- OR "Start from Scratch" (loads a generic baseline)
  |
  v
Main Workspace (viewport + panels)
  |-- Three.js viewport connects to backend via WebSocket
  |-- Initial aircraft mesh is generated by CadQuery and displayed
  |-- Status bar shows "Local" mode badge
```

**Cloud (Google Cloud Run):**

```
User navigates to: https://cheng.example.com
  |
  v
Cloud Run receives request
  |-- If container is cold (not running): cold start sequence (5-15 seconds)
  |   |-- Loading screen displayed in browser (see Section 1.3)
  |-- If container is warm: app loads immediately
  |
  v
FastAPI backend responds, frontend assets load
  |-- CadQuery geometry engine initializes (if cold start)
  |
  v
Template Picker (modal overlay in browser)
  |-- Choose a starter template (Trainer, Sport, Aerobatic, Glider, Flying Wing, Scale)
  |-- OR "Start from Scratch" (loads a generic baseline)
  |
  v
Main Workspace (viewport + panels)
  |-- Three.js viewport connects to backend via WebSocket
  |-- Initial aircraft mesh is generated by CadQuery and displayed
  |-- Status bar shows "Cloud" mode badge
```

**Common flow (both modes, after workspace loads):**

```
Global Configuration (right panel)
  |-- Set fuselage type, engine count, overall span, chord, tail type
  |-- Each change sends params to backend -> CadQuery regenerates -> new mesh in viewport
  |
  v
Component Refinement (click components in 3D viewport)
  |-- Wing: airfoil, sections, sweep, incidence, tip/root ratio
  |-- Tail: type, dihedral, angle, span, chord, incidence
  |-- Fuselage: (future) cross-section profile, length fine-tune
  |
  v
Validation Check
  |-- Automatic structural/aero warnings displayed inline
  |-- 3D printability checks (wall thickness, part size, overhangs)
  |-- User reviews and resolves any warnings
  |
  v
Export for 3D Printing
  |-- CadQuery generates STL files (auto-sectioned for print bed)
  |-- Download ZIP with all parts + assembly manifest
  |-- (In cloud mode, files stream directly to browser as download)
```

### 1.2 Workflow Principles

- **Templates first.** Most hobbyists have a category in mind ("I want a trainer"). Templates provide a safe, flyable starting point that users then customize. Starting from scratch is available but not the default path.
- **Global then local.** Users define the overall aircraft shape and identity with the Global Parameters panel, then click individual components to fine-tune details. This mirrors the mental model: "I want a 1200mm sport plane with a V-tail" (global) then "let me tweak the wing sweep to 28 degrees" (local).
- **Iterate freely.** There is no linear wizard. Users can jump between global and component parameters at any time. Changing a global parameter (e.g., tail type from conventional to V-tail) resets the tail component parameters to sensible defaults for the new type, with a brief toast notification: "Tail reset to V-Tail defaults."
- **Non-destructive.** Undo/redo supports free exploration. Parameter history lets users compare states.

### 1.3 Cold Start UX (Cloud Mode)

When deployed on Google Cloud Run, the container may be scaled to zero during periods of inactivity. The first request after a scale-down triggers a cold start, which can take 5-15 seconds while the container boots and CadQuery initializes.

**Loading screen design:**

The cold start loading screen is displayed immediately by the frontend (served from static assets / CDN) before the backend is ready:

```
+---------------------------------------------------------------+
|                                                               |
|                                                               |
|                                                               |
|              [Animated airplane silhouette]                   |
|              Assembles itself piece by piece:                 |
|              1. Fuselage outline draws in                    |
|              2. Wings extend from center                     |
|              3. Tail surfaces appear                         |
|              4. Propeller spins up                           |
|                                                               |
|              "Starting design engine..."                     |
|              "Loading airfoil database..."                   |
|              "Initializing geometry kernel..."               |
|              "Ready!"                                        |
|                                                               |
|              [Subtle progress bar at bottom]                 |
|                                                               |
+---------------------------------------------------------------+
```

**Progress text sequence:**
1. "Starting design engine..." (container is booting)
2. "Loading airfoil database..." (CadQuery is initializing)
3. "Initializing geometry kernel..." (OpenCascade is loading)
4. "Ready!" (WebSocket connection established, transitions to Template Picker)

The animated airplane silhouette assembles itself in sync with the progress stages -- the fuselage outline draws first, wings extend outward, tail surfaces appear, and finally a propeller begins spinning. This gives the user a sense of progress and reinforces the application's purpose.

**Post-cold-start behavior:**
- Once the container is warm, subsequent interactions are fast (WebSocket stays connected).
- The WebSocket connection persists for the duration of the session.
- Cloud Run enforces a maximum connection timeout of 3600 seconds (1 hour). If the WebSocket disconnects due to this timeout, the frontend shows a reconnection indicator (see Section 1.4) and automatically reconnects. The reconnection is transparent -- the user's current design state is preserved in the frontend.

### 1.4 Connection Status Indicator

The toolbar includes a small connection status dot in its right section, visible at all times:

| State | Indicator | Additional UI |
|-------|-----------|---------------|
| **Connected** | Green dot | None (normal operation) |
| **Reconnecting** | Yellow dot (pulsing) | Toast notification: "Reconnecting..." |
| **Disconnected** | Red dot | Mode-specific message (see below) |

**Cloud mode disconnect behavior:**
- If the Cloud Run container scales down due to inactivity, the next user interaction triggers a reconnect attempt.
- The yellow dot appears with a toast: "Reconnecting to server..."
- A cold start may occur (5-15 seconds). The loading animation from Section 1.3 is shown in a smaller overlay on the viewport (not full-screen, since the UI is already loaded).
- Once reconnected, the green dot returns and a toast confirms: "Reconnected."

**Local mode disconnect behavior:**
- If the Docker container stops or the connection is lost, the red dot appears.
- A non-blocking banner displays: "Backend unavailable. Is Docker running?"
- The UI becomes read-only (parameters visible but not editable).
- Automatic reconnection is attempted every 3 seconds. When the Docker container is restarted, the connection restores automatically.

**WebSocket timeout handling (cloud mode):**
- Cloud Run enforces a 3600-second (1 hour) WebSocket timeout.
- At 3540 seconds (1 minute before timeout), the frontend proactively sends a keepalive ping. If the connection drops anyway, the auto-reconnect mechanism activates.
- The user's design state is always held in the frontend; reconnection does not lose work.

---

## 2. Layout Architecture

### 2.1 Overall Screen Layout

```
+---------------------------------------------------------------+
|  [Menu Bar / Toolbar]                [Local] or [Cloud] badge |
+-------------------------------------------+-------------------+
|                                           |                   |
|                                           |  GLOBAL           |
|                                           |  PARAMETERS       |
|             VIEWPORT                      |  PANEL            |
|          (center, fills                   |  (right,          |
|           remaining space)                |   fixed width     |
|                                           |   ~280px)         |
|                                           |                   |
+---------------------------+---------------+-------------------+
|  COMPONENT DETAIL PANEL   |               ACTION BUTTONS      |
|  (bottom-left, ~60% w)    |               (bottom-right)      |
+---------------------------+---------- ---+--------------------+
```

The toolbar right section includes a small deployment mode badge: a pill-shaped label reading "Local" (with a Docker icon) or "Cloud" (with a cloud icon). This provides constant awareness of which mode the application is running in, which affects save/load behavior (see Section 2.6 and Appendix C).

### 2.2 Viewport (Center)

The viewport is the dominant element, occupying all space not claimed by panels. It is powered by **Three.js**, rendering a triangle mesh received from the CadQuery backend.

**Rendering:**
- Default view: top-down orthographic, matching the mockups.
- The aircraft is rendered as a 3D mesh with clean technical shading (muted gray material, subtle ambient occlusion, visible edge lines). Three.js renders the mesh sent from the Python/CadQuery backend.
- Dimension annotations are drawn as a Three.js overlay / HTML layer on top of the 3D canvas (see Section 5).

**Navigation:**
- **Zoom:** Scroll wheel or pinch gesture. Zoom is centered on the cursor position.
- **Pan:** Middle-click drag, or hold Space + left-click drag.
- **Orbit / Rotate:** Right-click drag to orbit the 3D view (Three.js OrbitControls).
- **View presets:** Toolbar buttons or keyboard shortcuts for Top (T), Front (F), Side (S), and Perspective (P) views. The default and primary view is always top-down.

**Viewport Behavior:**
- The aircraft auto-centers and auto-fits when major parameters change (e.g., span doubles).
- Smooth animated transitions when switching views or when large parameter changes cause significant geometry shifts.
- A subtle grid in the background provides scale reference. Grid spacing adapts to zoom level.

**Data flow for viewport updates:**
1. User changes a parameter in the browser UI.
2. Frontend sends updated parameter JSON to the Python backend via WebSocket.
3. CadQuery regenerates the parametric solid and tessellates it to a triangle mesh.
4. The mesh (vertices + faces, as a compact binary buffer or glTF) is sent back to the browser.
5. Three.js updates the scene with the new mesh. The previous mesh is replaced seamlessly.
6. Target round-trip latency: under 500ms for simple parameter changes. A spinner overlays the viewport if regeneration takes longer than 300ms.

### 2.3 Global Parameters Panel (Right)

A fixed-width panel (~280px) docked to the right edge. Always visible. Contains parameters that define the aircraft's overall configuration and identity.

**Contents (top to bottom):**

| Parameter | Control Type | Notes |
|-----------|-------------|-------|
| **Fuselage** | Dropdown | Pod, Stick, Conventional, Scale profile |
| **Engines** | Numeric stepper (1-4) + position dropdown (Nose / Wing) | Two small fields side-by-side as in mockup |
| **Wingspan** | Text input + slider | Primary dimension, in mm |
| **Wing Position** | Dropdown | High, Mid, Low, Shoulder |
| **Chord** | Two text inputs | Root chord and tip chord, in mm |
| **Tail Type** | Dropdown | Conventional, T-Tail, V-Tail, Cruciform, None (flying wing) |

**Design notes:**
- The panel has a dark background consistent with the mockups, with a clear "GLOBAL PARAMETERS" header.
- Each parameter row uses the label-left, control-right layout shown in the mockups.
- A subtle separator line divides logical groups (Fuselage/Engines, Wing dimensions, Tail).
- The panel scrolls vertically if content exceeds viewport height, but this should be rare given the limited number of global parameters.

### 2.4 Component Detail Panel (Bottom-Left)

This panel appears when the user clicks a component (wing, tail, fuselage, etc.) in the viewport.

**Behavior:**
- **Default state (nothing selected):** Panel shows "SELECT A COMPONENT TO CONFIGURE" in subdued text, exactly as in Screen 1.
- **Component selected:** Header changes to "{COMPONENT} SELECTED: SELECT AN ELEMENT FOR MORE OPTIONS" and parameter controls appear below, as in Screens 2 and 3.
- **Animation:** The panel content cross-fades when selection changes. No dramatic slide-in/out -- the panel shell is always visible; only the content changes. This avoids layout shift.
- **Height:** Fixed height (~200px). If parameters exceed the space, the panel scrolls internally. Target: 6-8 parameters visible without scrolling.

**Panel content per component:**

**Wing Selected:**
| Parameter | Control Type |
|-----------|-------------|
| Airfoil | Dropdown (searchable, with preview thumbnail) |
| Sections | Numeric input (number of panel sections) |
| Sweep | Text input + slider |
| Incidence | Text input + slider |
| Tip/Root Ratio | Text input |
| Dihedral | Text input + slider |
| Washout | Text input + slider |

**Tail Selected:**
| Parameter | Control Type |
|-----------|-------------|
| Type | Dropdown (mirrors global Tail Type for quick access) |
| Dihedral | Text input |
| Angle | Text input |
| Span | Text input |
| Chord | Text input + slider |
| Incidence | Text input |

**Fuselage Selected (1.0+):**
| Parameter | Control Type |
|-----------|-------------|
| Cross-Section | Dropdown (circular, oval, slab) |
| Nose Length | Text input + slider |
| Tail Boom Length | Text input + slider |
| Width | Text input |
| Height | Text input |

**3D Print Settings (per-component, collapsible sub-section within each component panel, 1.0+):**
| Parameter | Control Type | Notes |
|-----------|-------------|-------|
| Wall Thickness | Text input | Overrides global default for this component |
| Hollow Interior | Toggle | Hollow with defined wall thickness vs. solid |
| Section Count Override | Numeric stepper | Manual override for auto-sectioning |

In MVP, print settings are global-only (configured in the export dialog). Per-component print settings are a 1.0 feature.

### 2.5 Action Area (Bottom-Right)

The bottom-right corner hosts the primary action buttons. In the mockup this is a single "BUTTON" placeholder.

**Design:**
- **Primary action: "EXPORT STL"** -- large, prominent button. Opens the export dialog (see Section 7). The label explicitly says "STL" to reinforce the 3D printing workflow.
- **Secondary actions (1.0+):** Smaller buttons or a dropdown menu:
  - "VALIDATE" -- runs structural/aero and printability checks, displays results
  - "SAVE" -- saves current design (behavior depends on deployment mode; see Section 2.6)

In MVP, a single "EXPORT STL" button is sufficient.

### 2.6 Menu Bar / Toolbar (Top)

Not shown in the mockups but necessary for a complete application.

**Left section (File operations):**
- New (from template)
- Open (loads a saved JSON project file; source depends on deployment mode)
- Save / Save As (writes JSON project file; destination depends on deployment mode)
- Import (future: import reference images, airfoil .dat files)

**Save/Load behavior by deployment mode:**

| Operation | Local (Docker) | Cloud (Cloud Run) |
|-----------|---------------|-------------------|
| **File > Save** | Writes JSON project file to Docker volume (`/data` mapped to `~/.cheng` on host) via REST API | Stores JSON project data in browser IndexedDB |
| **File > Open** | REST API lists files from Docker volume; presented in a file picker UI within the app | Reads from browser IndexedDB; presented in a file picker UI listing saved designs |
| **File > Save As** | Writes to Docker volume with user-specified filename | Stores to IndexedDB with user-specified name |
| **Export (STL/ZIP)** | Downloads to user's computer via browser download dialog | Downloads to user's computer via browser download dialog (same behavior) |

In local mode, the file picker is powered by a REST API endpoint that lists and reads JSON files from the Docker volume. In cloud mode, the file picker reads from IndexedDB. The UI for both pickers is visually identical -- the user sees a list of saved designs with name, date, and a thumbnail preview.

**Center section (View controls):**
- View preset buttons: Top | Front | Side | 3D (1.0+)
- Zoom to fit button
- Toggle annotations on/off
- Toggle grid on/off

**Right section (Tools and Status):**
- Undo / Redo buttons (with keyboard shortcuts Ctrl+Z / Ctrl+Y)
- Connection status indicator (green/yellow/red dot; see Section 1.4)
- Deployment mode badge ("Local" or "Cloud")
- Settings (units toggle, theme)
- Help / About

The toolbar uses icon buttons with tooltips. Minimal text to preserve space.

---

## 3. Selection and Interaction Model

### 3.1 Selecting Components

**Primary method: Click on the aircraft in the 3D viewport.**

The CadQuery backend generates the aircraft as separate named mesh groups (one per component). Three.js loads these as distinct `THREE.Mesh` objects, enabling per-component interaction via raycasting.

The aircraft is divided into clickable mesh groups:
- **Wings** (left and right treated as one component -- symmetric design, single mesh group)
- **Tail** (horizontal + vertical stabilizers treated as one component)
- **Fuselage** (the body)
- **Engine(s)** (future: nacelles, prop disk)

**Click behavior:**
1. User moves cursor over the viewport. Three.js `Raycaster` determines which mesh group is under the cursor.
2. The component under the cursor receives a **hover highlight**: a subtle brightening or emissive glow (e.g., soft yellow emissive at 30% intensity). The cursor changes to a **pointer** (hand icon).
3. User clicks. The component becomes **selected**: bright yellow material applied to the mesh group, as shown in Screens 2 and 3. The Component Detail Panel updates to show that component's parameters.
4. Clicking a different component switches the selection (previous component reverts to default material, new one gets yellow).

### 3.2 Hover States

| State | Visual Treatment | Cursor |
|-------|-----------------|--------|
| Default (no hover) | Normal rendering | Default arrow |
| Hovering over component | Subtle glow / light outline | Pointer (hand) |
| Component selected | Bright yellow highlight | Default arrow (on selected) / Pointer (on other components) |
| Hovering over empty space | No change | Default arrow |

### 3.3 Deselection

- **Click on empty viewport space** (background/grid area) to deselect. The Component Detail Panel returns to the default "SELECT A COMPONENT TO CONFIGURE" state.
- **Press Escape** to deselect.

### 3.4 Single Selection Only

Only one component can be selected at a time. Justification:
- The Component Detail Panel shows parameters for one component. Multi-selection would require either merging parameter sets (confusing) or showing multiple panels (cluttered).
- RC plane design is inherently sequential -- you tune one part at a time.
- Multi-select adds interaction complexity (Shift+click, Ctrl+click) that provides no clear benefit for this use case.

### 3.5 Sub-Selection (Future)

In 1.0 or later, clicking a selected wing could cycle through sub-elements:
- First click: select wing (shows wing parameters).
- Second click on the same wing: enters sub-selection mode. Clickable zones for: left aileron, right aileron, flap, wing tip. The detail panel updates to show sub-element parameters.
- Press Escape or click elsewhere to exit sub-selection.

This is not needed for MVP. Wings and tails are treated as single parametric units.

---

## 4. Parameter Input Design

### 4.1 Control Type Guidelines

| Scenario | Control | Rationale |
|----------|---------|-----------|
| Choosing from a fixed set (airfoil, fuselage type, tail type) | **Dropdown** | Discrete options, no continuous range |
| Continuous numeric value with a meaningful range (sweep 0-45 deg, incidence -5 to +5 deg) | **Text input + slider** | Slider for quick exploration, text input for precision |
| Continuous numeric value with a wide/open range (span 200-3000mm) | **Text input only** | Slider would compress useful ranges; text is more practical |
| Small integer (engine count 1-4, wing sections 1-5) | **Numeric stepper** (- / + buttons flanking a number) | Prevents invalid non-integer input |
| Binary toggle (symmetric yes/no, annotations on/off) | **Toggle switch** | Clear on/off state |
| Ratio or proportion (tip/root ratio) | **Text input** with live computed preview | Ratio is a single number; a slider could work too |

### 4.2 Slider + Text Input Combo

For parameters that use both:
- The slider and text input are bidirectionally linked. Dragging the slider updates the text field. Typing in the text field moves the slider.
- The slider has defined min/max bounds (e.g., sweep: 0 to 60 degrees). The text input allows values slightly outside this range (e.g., up to 70 degrees) but shows a warning.
- Slider drag provides haptic-like visual feedback: the viewport geometry updates in real time as the user drags.

### 4.3 Linked / Computed Parameters

Some parameters are interdependent. The UI should surface these relationships:

- **Aspect Ratio** is computed from Span and Chord. It is displayed as a read-only computed value below the Span/Chord inputs, updating live.
- **Wing Area** is computed from Span, Root Chord, and Tip Chord. Displayed as read-only.
- **Tail Volume Coefficient** is computed from tail dimensions relative to wing. Displayed in a "Computed Values" sub-section of the component panel.
- Changing **Wingspan** in the global panel does NOT auto-scale chord (the user might want a different aspect ratio). But the computed Aspect Ratio display immediately shows the new value, alerting the user if it falls outside a recommended range.

Computed values are displayed in a lighter/italic font with a small "computed" icon, making it clear they are derived and not directly editable.

### 4.4 Real-Time Preview

Every parameter change triggers a geometry regeneration request to the CadQuery backend:
- **Text input:** Sends the update after a 300ms debounce. If the user is typing "1200", the backend does not regenerate for 1, 12, 120 -- it waits 300ms after the last keystroke. This balances responsiveness with backend load.
- **Slider drag:** Sends updates at a throttled rate (every 100ms while dragging). The frontend can optionally apply a lightweight local approximation (scale/transform the existing mesh) for instant visual feedback while waiting for the full CadQuery regeneration to arrive.
- **Dropdown change:** Sends immediately on selection.
- **Backend queuing:** If a new parameter change arrives while CadQuery is still processing a previous one, the in-progress regeneration is cancelled (if possible) and the latest parameters are used for the next regeneration. The frontend always displays the most recent completed mesh.
- **Loading state:** A subtle semi-transparent overlay with a small spinner appears on the viewport if regeneration takes more than 300ms. The previous mesh remains visible underneath to avoid blank flashes.

### 4.5 Validation and Feedback

**Inline validation:**
- Each input field shows a red outline and a brief error message below if the value is out of the acceptable range. Example: Chord input shows "Must be between 20mm and 500mm."
- Warning (orange outline) for values that are technically valid but structurally questionable. Example: Wing incidence > 5 degrees shows "High incidence may cause excessive drag."

**Structural validation:**
- A dedicated validation pass (triggered by the "Validate" button or automatically before export) checks higher-level constraints: CG position, wing loading, tail volume, structural thickness ratios.
- Results appear in a validation summary overlay (modal or slide-in panel) with a list of warnings/errors, each with a "Go to parameter" link that selects the relevant component and highlights the parameter.

### 4.6 Units

- **Default unit: millimeters (mm).** This is standard for RC plane plans.
- **Unit toggle** in the toolbar/settings: mm / inches. When toggled, all displayed values convert. Internal storage is always in mm.
- Angles are always in degrees.
- Unit labels appear inside or next to each input field (e.g., the input shows "1200" and a small "mm" label sits to its right).

---

## 5. Dimension Annotations

### 5.1 Always-Visible Annotations

The following annotations are always displayed on the viewport (as shown in the mockups):

| Annotation | Position | Style |
|------------|----------|-------|
| **Overall Length** | Top of viewport, horizontal leader line spanning nose to tail | Dimension line with end ticks, value centered above |
| **Wingspan** | Right side of viewport, vertical leader line spanning wingtip to wingtip | Dimension line with end ticks, value centered to the right |
| **Sweep Angle** | Near the wing leading edge, arc indicator with angle value | Arc line with degree label |

These are the "identity dimensions" -- the numbers a hobbyist cares about most and would quote when describing their plane.

### 5.2 Contextual Annotations

Additional annotations appear when a component is selected:

**Wing selected:**
- Root chord dimension (at fuselage junction)
- Tip chord dimension (at wingtip)
- Dihedral angle indicator (visible in front view)
- Incidence angle indicator (visible in side view)

**Tail selected:**
- Tail span dimension
- Tail chord dimension
- V-tail dihedral angle arc (for V-tail type)
- Moment arm (distance from wing quarter-chord to tail quarter-chord)

### 5.3 Annotation Behavior

- Annotations update in real time as parameters change. If the user drags the span slider, the span annotation value and leader line endpoints animate smoothly.
- Annotations use a consistent style: thin white/light-gray lines, small sans-serif text, minimal visual weight to avoid cluttering the viewport.
- Annotations avoid overlapping the aircraft geometry. If necessary, leader lines route around components.

### 5.4 Direct Edit via Annotations (1.0+)

- Clicking on an annotation value (e.g., the "300.00" length label) converts it into an inline text input. The user can type a new value and press Enter to apply it.
- This provides a shortcut for users who want to "sketch with dimensions" rather than hunting for the parameter in a panel.
- The edited value propagates back to the corresponding parameter in the Global or Component panel.

---

## 6. Templates and Presets

### 6.1 Starter Templates

Presented in the Template Picker modal on app launch and accessible via File > New.

| Template | Description | Key Characteristics |
|----------|-------------|-------------------|
| **Trainer** | Stable, forgiving design for beginners | High wing, flat-bottom airfoil, conventional tail, moderate span |
| **Sport** | All-around performance | Mid wing, semi-symmetrical airfoil, moderate sweep |
| **Aerobatic** | Agile, symmetrical | Mid/low wing, symmetrical airfoil, large control surfaces |
| **Glider** | High aspect ratio, efficient | High wing, high AR, long span, T-tail or V-tail |
| **Flying Wing** | No tail, blended design | Swept wing, no fuselage tail section, elevons |
| **Scale** | Realistic proportions | Configurable to mimic real aircraft silhouettes |

Each template card in the picker shows:
- A small silhouette preview of the aircraft
- The template name and a one-line description
- Key specs (e.g., "Span: 1200mm, Conventional tail")

### 6.2 Component Presets

**Airfoil presets (dropdown in Wing component panel):**
- Organized by category: Flat Bottom (trainer), Semi-Symmetrical (sport), Symmetrical (aerobatic), High-Lift (slow flyer), Custom (.dat import -- future).
- Each entry shows: name (e.g., "Clark Y"), a tiny profile silhouette, and a one-line characteristic ("Flat bottom, good lift, gentle stall").

**Tail configuration presets:**
- The Tail Type dropdown in the Global panel acts as a preset. Selecting "V-Tail" loads default V-tail geometry (dihedral, angle, span, chord) into the Tail component parameters.

### 6.3 Custom Presets (1.0+)

- Users can save their current design as a custom template via File > Save as Template.
- Custom templates appear in the Template Picker under a "My Templates" section.
- Individual component configurations (e.g., a specific wing setup) can be saved as component presets for reuse across designs.

---

## 7. Export and Output

The primary fabrication method is **FDM 3D printing**. The export pipeline is powered by CadQuery on the Python backend, which generates watertight solid geometry and tessellates it directly to STL.

### 7.1 Supported Formats

| Format | Use Case | MVP? |
|--------|----------|------|
| **STL** | 3D printing all aircraft parts (primary format) | **Yes (MVP)** |
| **STEP** | Exchange with other CAD tools (Fusion 360, FreeCAD) for advanced users | 1.0 |
| **DXF** | Laser cutting flat parts (ribs, formers) if needed | 1.0 |
| **SVG** | Web-friendly 2D outlines; documentation | 1.0 |
| **PDF** | Printed plan sheets with dimensions, part labels, build notes | Future |
| **JSON / Project File** | Save/load the parametric design itself (not geometry) | Yes (MVP, internal) |

### 7.2 3D Printing Considerations in Export

Because the aircraft will be 3D printed on typical FDM printers (bed sizes ~220x220mm to ~350x350mm), the export pipeline must handle:

**Part sectioning:**
- Wings, fuselage, and tail surfaces that exceed the print bed are automatically sectioned into printable segments.
- The user can configure **maximum part size** (defaults to 220x220x250mm, matching common printers like the Ender 3 / Prusa MK4).
- Section cuts include integrated **alignment features**: dovetail joints, pin-and-socket connectors, or tongue-and-groove slots so parts snap/glue together accurately.
- Each section is exported as a separate STL file, named descriptively (e.g., `wing_left_section_1of3.stl`, `fuselage_mid.stl`).

**Print-friendly geometry:**
- Minimum wall thickness is enforced (default: 1.2mm / 3 perimeters at 0.4mm nozzle). The validation system warns if any wall drops below this.
- The export dialog includes a **print orientation suggestion** for each part (e.g., "Print wing section flat, trailing edge down").
- Hollow structures with internal lattice/sparse infill zones are defined in the CadQuery model where appropriate (e.g., fuselage sections).

**Assembly:**
- Connector geometry (pins, slots, screw bosses) is generated parametrically as part of the CadQuery model. These are not user-facing parameters in MVP -- they are computed automatically based on section cuts.
- A **parts manifest** is included in the export: a text/HTML file listing all parts, recommended print settings (layer height, infill %), and assembly order.

### 7.3 Export Dialog

Triggered by the "EXPORT" button in the bottom-right action area. The backend (CadQuery) generates all files; the browser triggers a download.

**Dialog layout:**
```
+-----------------------------------------------+
|  EXPORT FOR 3D PRINTING                       |
|                                               |
|  Format:  [STL (primary)]  [STEP]  [DXF]     |
|           (toggle buttons, multi-select)      |
|                                               |
|  Printer bed size:                            |
|   X: [220] mm  Y: [220] mm  Z: [250] mm     |
|                                               |
|  Components to export:                        |
|   [x] Wings (left + right)                   |
|   [x] Fuselage                               |
|   [x] Tail surfaces                          |
|   [x] Engine mount / cowling                  |
|   [ ] Full assembly (single STL, for ref)    |
|                                               |
|  Options:                                     |
|   [x] Auto-section parts for bed size        |
|   [x] Include alignment connectors            |
|   [x] Include parts manifest                  |
|   Min wall thickness: [1.2] mm               |
|                                               |
|  [Preview]                [Export] [Cancel]   |
+-----------------------------------------------+
```

**Export flow by deployment mode:**

**Local (Docker) mode:**
1. User clicks "Export".
2. Browser sends export request with options to the backend via REST API.
3. CadQuery generates the solid geometry, sections parts, adds connectors, tessellates to STL.
4. Backend packages all STL files + manifest into a ZIP archive.
5. Browser downloads the ZIP file via a standard file-save dialog.
6. A toast notification confirms: "Exported 12 parts to rc_plane_export.zip".

**Cloud (Cloud Run) mode:**
1. User clicks "Export".
2. Browser sends export request with options to the backend via REST API.
3. CadQuery generates the solid geometry, sections parts, adds connectors, tessellates to STL.
4. Backend streams the ZIP archive directly to the browser as a download response. No server-side file storage is used -- the archive is generated and streamed in a single response.
5. Browser saves the file via the standard download mechanism.
6. A toast notification confirms: "Exported 12 parts to rc_plane_export.zip".

**Large export handling (cloud mode):**
- For complex aircraft with many sections, the export ZIP can be large (50-200MB).
- The export dialog shows a **progress bar** during generation and streaming.
- Progress is reported via a secondary WebSocket channel or Server-Sent Events: "Generating wing sections... (3/12)", "Packaging ZIP...", "Downloading..."
- If the download is interrupted (e.g., network issue), the user can retry. The backend regenerates the export (no server-side caching in cloud mode).

### 7.4 Export Preview

Clicking "Preview" opens a full-screen overlay showing exactly what will be exported:
- For STL: each individual part rendered in Three.js with distinct colors, shown on a ghost outline of the print bed for size reference. Parts that exceed the bed are highlighted in red. Polygon count and estimated weight (based on infill %) are displayed per part.
- For STEP/DXF: a summary list of files that will be generated.

Users can adjust options (bed size, wall thickness) and see the preview update before committing to the export.

---

## 8. Error Handling and Validation

### 8.1 Parameter-Level Validation

| Condition | Visual Indicator | Behavior |
|-----------|-----------------|----------|
| Value out of hard range (e.g., negative span) | Red outline on input + red error text below | Value is rejected / clamped. Viewport does not update with invalid geometry. |
| Value out of soft range (e.g., sweep > 45 deg) | Orange outline + warning text | Value is accepted. Viewport updates. Warning is informational. |
| Non-numeric input in numeric field | Red outline + "Enter a number" message | Value is rejected. |
| Empty required field | Red outline + "Required" message | Previous valid value is retained in the model. |

### 8.2 Structural / Aerodynamic Warnings

These are checked automatically as parameters change (debounced) and displayed in a collapsible warning bar at the top of the viewport or within the validation summary:

| Warning | Trigger | Severity |
|---------|---------|----------|
| Wing too thin | Max airfoil thickness < 6% at any section | Error (likely unbuildable) |
| CG out of range | Estimated CG falls outside 25-35% MAC | Warning |
| Excessive wing loading | Estimated wing loading > threshold for category | Warning |
| Insufficient tail volume | Tail volume coefficient below minimum for stability | Warning |
| Tip chord too small | Tip chord < 40mm (difficult to build/print) | Warning |
| Aspect ratio extreme | AR > 15 or AR < 3 | Warning |

### 8.3 3D Printability Warnings

Because the primary output is FDM-printed parts, the validation system includes print-specific checks:

| Warning | Trigger | Severity |
|---------|---------|----------|
| Wall too thin | Any wall < minimum wall thickness (default 1.2mm) | Error |
| Overhang angle | Surfaces with >60 deg unsupported overhang in suggested print orientation | Warning ("may need supports") |
| Part too large | Any single section exceeds configured bed size even after auto-sectioning | Error |
| Too many sections | A component requires more than 8 sections to fit the bed | Warning ("consider increasing bed size or reducing span") |
| Trailing edge too sharp | Wing/tail trailing edge tapers below 0.6mm (will not print cleanly) | Warning ("trailing edge will be rounded to min printable width") |
| Connector clearance | Assembly connectors have insufficient clearance for FDM tolerance (< 0.2mm gap) | Warning |

### 8.4 Visual Indicators in Viewport

- Components with warnings show a small warning icon (triangle with exclamation mark) near the component in the viewport.
- Components with errors show a red pulsing outline.
- Clicking the warning icon opens a tooltip with the specific warning message and a "Fix" suggestion (e.g., "Increase tail span or chord to improve stability").
- For printability warnings, thin walls or sharp edges can be highlighted in red directly on the 3D mesh in the Three.js viewport.

### 8.5 Pre-Export Validation

Before export, a mandatory validation pass runs all checks. If errors exist, the export is blocked and the user is shown the validation summary with actionable guidance. Warnings allow export but are shown for acknowledgment.

---

## 9. Phase Breakdown

### 9.1 MVP (Minimum Viable Product)

**Goal:** A containerized web app (Docker) that generates a parametric RC plane and exports 3D-printable STL files. Deployable locally or on Google Cloud Run.

**Architecture:** Python backend (FastAPI + CadQuery) packaged as a Docker container. Browser frontend with Three.js viewport. Communication via WebSocket (real-time parameter updates) and REST (export, file operations). Deployable locally via `docker run` or on Google Cloud Run for zero-install cloud access.

**Included:**
- Three.js viewport with 3D mesh rendering, orbit/zoom/pan controls, default top-down view
- Global Parameters panel: Fuselage type, Engines, Wingspan, Chord (root/tip), Tail Type
- Component selection by clicking on the 3D mesh in the viewport (Wing and Tail only)
- Wing component panel: Airfoil (dropdown), Sections, Sweep, Incidence, Tip/Root Ratio
- Tail component panel: Type, Dihedral, Angle, Span, Chord, Incidence
- Yellow highlight on selected component (Three.js material swap)
- Always-on dimension annotations (length, span, sweep angle)
- One starter template (Trainer) with hardcoded defaults
- **STL export** with auto-sectioning for print bed size and alignment connectors
- Parts manifest (list of files, print orientation suggestions)
- Save/load design: JSON to Docker volume (local mode) or IndexedDB (cloud mode)
- Basic parameter validation (range checking, red/orange outlines)
- Basic 3D printability validation (wall thickness, part size)
- Keyboard shortcut: Ctrl+Z / Ctrl+Y for undo/redo (single level)
- Docker-based launch: `docker run -p 8000:8000 -v ~/.cheng:/data cheng`
- Cloud Run deployment with cold start loading screen
- Connection status indicator (green/yellow/red dot)
- Deployment mode badge ("Local" or "Cloud") in toolbar

**Not included:** Multiple view presets, fuselage component detail, templates beyond Trainer, STEP/DXF/PDF export, direct-edit annotations, sub-selection, full structural validation, custom presets.

### 9.2 Version 1.0

**Goal:** A polished, full-featured tool suitable for public release.

**Adds:**
- All 6 starter templates (Trainer, Sport, Aerobatic, Glider, Flying Wing, Scale)
- Fuselage component panel with detail parameters
- Top, Front, and Side view presets (toolbar buttons + keyboard shortcuts)
- Contextual dimension annotations (appear per selected component)
- Direct-edit annotations (click dimension value to edit inline)
- STEP and DXF export formats (in addition to STL)
- Export preview with per-part print bed visualization
- Full structural/aerodynamic validation (CG, tail volume, wing loading) with warning bar
- Full 3D printability validation (overhangs, trailing edge sharpness, connector clearance)
- Computed parameter display (aspect ratio, wing area, tail volume coefficient)
- Custom presets (save/load templates and component configurations)
- Multi-level undo/redo with history list
- Toolbar with view controls, file operations, settings
- Unit toggle (mm / inches)
- Responsive layout for different screen sizes (minimum: 1280x720)
- Configurable print bed size in user preferences (persisted between sessions)
- Cloud mode: design import/export between IndexedDB and JSON file download/upload for portability

### 9.3 Future Enhancements

- **Multi-view layout** (top + front + side simultaneously, linked navigation)
- **Simulation preview** -- estimated flight characteristics overlay (stall speed, glide ratio, stability margin)
- **Slicer integration** -- direct export to PrusaSlicer / Cura project files with recommended print settings per part
- **Weight estimation** -- computed part weight based on infill %, filament density, and wall thickness
- **Community sharing** -- publish designs to a gallery, fork other designs
- **Airfoil .dat import** -- load custom airfoil profiles
- **Reference image overlay** -- trace a real aircraft photo for scale builds
- **PDF build plans** -- fully annotated printable plans with cut lists, material requirements, and assembly instructions
- **Version history** -- timeline of design changes with named snapshots
- **Collaboration** -- real-time co-editing
- **Plugin API** -- allow community-built extensions (custom export formats, analysis tools)
- **Cloud storage integration** -- optional Google Cloud Storage backend for persistent cloud designs
- **User accounts** -- optional sign-in for cloud mode to persist designs server-side

---

## 10. Global vs. Component Parameter Rationale

### 10.1 Design Principle

> **Global parameters define WHAT the aircraft IS. Component parameters define HOW each part is shaped.**

The Global Parameters panel answers: "Describe this plane in one sentence." The Component Detail panels answer: "Now tell me exactly how you want this wing/tail/fuselage."

### 10.2 Full Breakdown

#### Global Parameters (Right Panel -- always visible)

| Parameter | Why Global |
|-----------|-----------|
| **Fuselage Type** | Defines the fundamental airframe architecture. A pod-and-boom plane is a fundamentally different aircraft than a conventional fuselage. This choice cascades into available tail types and engine mounting options. |
| **Engines (count + position)** | Engine configuration is an aircraft-level decision that affects CG, thrust line, structural loads, and fuselage design. It is not a detail of any single component. |
| **Wingspan** | The single most important dimension of any RC plane. Hobbyists describe their planes as "a 48-inch trainer" -- span IS identity. It must be visible and editable at all times. |
| **Wing Position** | High/mid/low wing fundamentally changes the aircraft's character, stability, and appearance. This is an identity decision, not a wing detail. |
| **Chord (Root/Tip)** | Together with span, chord defines the wing planform and area -- the most critical performance parameters. Both are shown as primary dimension annotations. Keeping them global means users can establish the overall planform without selecting the wing. |
| **Tail Type** | Conventional, T-tail, V-tail, or none (flying wing) is an architectural decision that changes the entire rear of the aircraft and determines what tail component parameters exist. |

#### Component Parameters (Bottom-Left Panel -- shown on selection)

| Parameter | Component | Why Component-Level |
|-----------|-----------|-------------------|
| **Airfoil** | Wing | A refinement choice. Most beginners never change it from the template default. Does not change the aircraft's silhouette or identity. |
| **Sections** | Wing | Technical construction detail (how many ribs/panels). Does not affect the visual planform. |
| **Sweep** | Wing | Affects the wing shape but not the overall aircraft identity. Two planes can have the same span/chord but different sweep. |
| **Incidence** | Wing, Tail | Fine-tuning parameter for pitch trim. Not visible in top-down view. |
| **Tip/Root Ratio** | Wing | Planform refinement. The root and tip chords are set globally; this ratio adjusts the taper distribution. |
| **Dihedral** | Wing, Tail | Not visible in top-down view. A tuning parameter for roll stability. |
| **Washout** | Wing | Advanced aerodynamic tuning. Most users never touch it. |
| **Tail Dihedral, Angle, Span, Chord** | Tail | Once the tail TYPE is set globally, these fine-tune its geometry. |

#### Parameters That Could Be Argued Either Way

| Parameter | Placed In | Reasoning |
|-----------|-----------|-----------|
| **Tail Type** | Global (with mirror in Tail component panel) | It changes the aircraft identity, so it belongs in Global. But when the tail is selected, it is convenient to have it accessible in the component panel too. Solution: show it in both places, bidirectionally linked. Changing it in either location updates both. |
| **Chord (Root/Tip)** | Global | One could argue chord is a wing detail. However, chord plus span defines wing area, which is the most fundamental performance parameter. It is more important than airfoil selection and should be prominent. Tip/Root Ratio in the wing component panel gives additional refinement. |
| **Wing Position** | Global | Wing position (high/mid/low) could be a wing component detail, but it so fundamentally changes the aircraft's appearance and stability character that it belongs with the "identity" parameters. |

### 10.3 The Test

When deciding where a parameter belongs, apply this test:

> "If I change this parameter, would an observer looking at the plane say it's a *different kind* of plane, or the *same plane, tweaked*?"

- Change tail type from conventional to V-tail: *different kind of plane.* --> Global.
- Change wing sweep from 25 to 30 degrees: *same plane, tweaked.* --> Component.
- Change wingspan from 1000mm to 1500mm: *could be either, but span is THE defining dimension.* --> Global.
- Change airfoil from Clark Y to NACA 2412: *same plane, tweaked (most people can't tell by looking).* --> Component.

---

## Appendix A: Keyboard Shortcuts

| Shortcut | Action |
|----------|--------|
| `Ctrl+Z` | Undo |
| `Ctrl+Y` / `Ctrl+Shift+Z` | Redo |
| `Ctrl+S` | Save |
| `Ctrl+E` | Export |
| `Escape` | Deselect component / Close dialog |
| `T` | Top view |
| `F` | Front view (1.0+) |
| `S` | Side view (1.0+) |
| `Space + drag` | Pan viewport |
| `Scroll wheel` | Zoom |
| `Ctrl+0` | Zoom to fit |
| `Delete` | (No effect -- parameters cannot be deleted, only changed) |

## Appendix B: Color Palette

| Element | Color | Hex (approx) |
|---------|-------|------|
| Viewport background | Dark charcoal | `#2A2A2E` |
| Panel background | Darker charcoal | `#1E1E22` |
| Aircraft body (default) | Medium gray with subtle shading | `#6B6B70` |
| Component hover highlight | Soft yellow glow (30% opacity) | `#FFD60A` at 30% |
| Component selected highlight | Bright yellow | `#FFD60A` |
| Dimension annotation lines | Light gray | `#A0A0A5` |
| Dimension annotation text | White | `#FFFFFF` |
| Input field background | Dark | `#333338` |
| Input field text | White | `#F0F0F0` |
| Error state | Red | `#FF4444` |
| Warning state | Orange | `#FFA033` |
| Success / valid | Green | `#44CC66` |
| Primary action button | Accent blue | `#4A90D9` |
| Connection dot: connected | Green | `#44CC66` |
| Connection dot: reconnecting | Yellow (pulsing) | `#FFA033` |
| Connection dot: disconnected | Red | `#FF4444` |
| Mode badge: Local | Subtle blue | `#4A90D9` at 20% bg |
| Mode badge: Cloud | Subtle purple | `#9B59B6` at 20% bg |

## Appendix C: Deployment Modes UX

The application supports two deployment modes, each with distinct UX characteristics. The mode is detected automatically at startup (the frontend checks whether the backend reports `local` or `cloud` mode via a `/api/mode` endpoint).

### Local Docker Mode

**Setup:** User runs the Docker container on their own machine.

```
docker run -p 8000:8000 -v ~/.cheng:/data cheng
```

**Characteristics:**
- Full performance, no network latency (backend runs on localhost).
- Designs are stored as JSON files on the Docker volume (`~/.cheng` on host, `/data` in container).
- File operations (Save/Open) use a REST API that reads/writes to the Docker volume.
- No cold start delay -- the container is always running while in use.
- No internet connection required after initial Docker image pull.
- The user stops the application by stopping the Docker container (`docker stop` or Ctrl+C).

### Cloud Mode (Google Cloud Run)

**Setup:** User navigates to the application URL (e.g., `https://cheng.example.com`). No installation required.

```
User opens browser -> navigates to https://cheng.example.com -> app loads
```

**Characteristics:**
- Zero-install access from any machine with a modern browser.
- Cold start delay of 5-15 seconds if the container has scaled to zero (loading screen shown; see Section 1.3).
- Designs are stored in browser IndexedDB (no server-side storage for user designs).
- Exports are streamed directly to the browser as downloads (no server-side file persistence).
- WebSocket connection timeout at 3600 seconds; auto-reconnect handles this transparently.
- Performance after initial load is comparable to local mode for typical interactions.
- Multiple users each get their own container instance (Cloud Run scales horizontally).

### Mode Comparison Table

| Aspect | Local (Docker) | Cloud (Cloud Run) |
|--------|---------------|-------------------|
| **Installation** | `docker pull` + `docker run` | None (URL access) |
| **Launch time** | 2-5 seconds (container start) | 5-15 seconds (cold start) or instant (warm) |
| **Design storage** | Docker volume (`~/.cheng`) | Browser IndexedDB |
| **File picker** | REST API listing Docker volume contents | IndexedDB listing in-browser |
| **Export download** | Browser download from localhost | Browser download streamed from Cloud Run |
| **Network required** | No (after image pull) | Yes (always) |
| **Performance** | Full (local compute) | Full after cold start; possible latency for large geometry |
| **Concurrent users** | Single user | Multi-user (Cloud Run auto-scaling) |
| **Data portability** | JSON files on disk (easy to backup/share) | Export design as JSON download; import on another device |
| **Connection indicator** | Green/red (connected/Docker stopped) | Green/yellow/red (connected/reconnecting/disconnected) |
| **Max session duration** | Unlimited | 3600s WebSocket timeout (auto-reconnects) |
| **Cost** | Free (user's hardware) | Cloud Run compute charges (pay-per-use) |
| **Mode badge** | "Local" (blue) in toolbar | "Cloud" (purple) in toolbar |

### Data Portability Between Modes

To enable users to move designs between local and cloud modes:
- **Export design as JSON:** Available in both modes via File > Export Design. Downloads the parametric design JSON to the user's computer.
- **Import design from JSON:** Available in both modes via File > Import Design. Reads a JSON design file and loads it into the workspace, saving it to the appropriate storage backend (Docker volume or IndexedDB).
- This ensures that a user who starts designing in cloud mode can later switch to local Docker mode (or vice versa) without losing work.

### Performance Expectations

- **CadQuery regeneration time:** Target under 500ms for typical parameter changes. Complex geometry (many wing sections, detailed fuselage) may take 1-2 seconds. The UI must remain responsive during this time (non-blocking updates).
- **STL export with sectioning:** May take 5-15 seconds for a full aircraft with many parts. A progress bar is shown in the export dialog. In cloud mode, the progress bar also tracks the download stream.
- **Memory usage:** CadQuery + OpenCascade can use 200-500MB RAM. The frontend (Three.js) adds another 50-200MB depending on mesh complexity. Total: plan for ~500MB-1GB during active use. Cloud Run container memory should be configured accordingly (minimum 1GB).

## Appendix D: Responsive Considerations

The tool is designed for desktop screens (minimum 1280x720).

- At widths below 1440px, the Global Parameters panel narrows slightly and uses stacked label/control layout instead of side-by-side.
- At widths below 1280px, the Component Detail panel moves to a slide-up overlay on top of the viewport rather than occupying fixed bottom space.
- Tablet support (1.0+): touch targets increase to 44px minimum; hover states convert to tap states; a floating toolbar replaces the fixed menu bar.
- Mobile is not supported. RC plane design requires screen real estate.
